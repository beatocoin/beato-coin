FROM node:22-bullseye

# Set up pnpm
ENV PNPM_HOME="/pnpm"
ENV PATH="$PNPM_HOME:$PATH"
RUN corepack enable

# Install necessary tools
RUN apt update && apt install -y \
    python3 \
    build-essential \
    g++ \
    libssl-dev \
    git

WORKDIR /app

# Copy package files
COPY package.json pnpm-lock.yaml* ./
COPY nextjs-template/package.json ./nextjs-template/

# Install dependencies
RUN pnpm install

# Copy application files
COPY . .

# Copy submodule files
COPY nextjs-template ./nextjs-template

# Set environment variables
ENV NODE_ENV=development
ENV NEXT_TELEMETRY_DISABLED=1
ENV PORT=3002
ENV HOSTNAME="0.0.0.0"

EXPOSE 3002

CMD ["pnpm", "dev"] 